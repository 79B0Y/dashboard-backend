// pm2.config.js â€“ PM2 è¿›ç¨‹ç®¡ç†å™¨é…ç½®
// ------------------------------------------------------------
// pm2-runtime ä¼šè¯»å–æ­¤æ–‡ä»¶ï¼Œåœ¨ç”Ÿäº§å®¹å™¨ä¸­ä¿æŒè¿›ç¨‹å®ˆæŠ¤ã€è‡ªåŠ¨é‡å¯ã€‚
// è¯¦ç»†æ–‡æ¡£ï¼šhttps://pm2.keymetrics.io/docs/usage/application-declaration/
// ------------------------------------------------------------

module.exports = {
  apps: [
    {
      name: 'dashboard-backend',   // è¿›ç¨‹åç§°ï¼Œå¯é€šè¿‡ `pm2 ls` æŸ¥çœ‹
      script: 'server.js',         // å¯åŠ¨è„šæœ¬

      // ğŸ“¦ ç¯å¢ƒå˜é‡ï¼ˆå¼€å‘ / ç”Ÿäº§å¯åŒºåˆ†ï¼‰
      env: {
        NODE_ENV: 'development',
        PORT: 3001
      },
      env_production: {
        NODE_ENV: 'production',
        PORT: 3001
      },

      // ğŸŒ¡ èµ„æºä¸ç¨³å®šæ€§
      instances: 1,               // å¯æ”¹ä¸º 'max' å¼€å¯å¤šæ ¸ cluster
      autorestart: true,
      watch: false,               // ç”Ÿäº§ç¯å¢ƒä¸å¯ç”¨æ–‡ä»¶ç›‘è§†
      max_memory_restart: '300M'  // å†…å­˜è¶…è¿‡ 300M è‡ªåŠ¨é‡å¯
    }
  ]
};

/*
ğŸ“Œ å…³é”®å­—æ®µè¯´æ˜
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ name            â€“ PM2 è¿›ç¨‹åï¼Œå½±å“æ—¥å¿—æ–‡ä»¶å & å‘½ä»¤åˆ«å
â€¢ script          â€“ Node å…¥å£æ–‡ä»¶ï¼›ä¹Ÿå¯ä¼  shell/sh æ‰§è¡Œ
â€¢ env / env_production â€“ å¤šç¯å¢ƒå˜é‡ï¼ˆ`pm2 start pm2.config.js --env production`ï¼‰
â€¢ instances       â€“ è¿›ç¨‹æ•°ï¼›è®¾ç½®ä¸º `max` ä½¿ç”¨ CPU æ ¸å¿ƒæ•° cluster æ¨¡å¼
â€¢ watch           â€“ å¼€å‘å¯ä¸º trueï¼Œç”Ÿäº§å…³æ‰ä»¥å…è§¦å‘é‡å¯
â€¢ max_memory_restart â€“ å†…å­˜é˜ˆå€¼ï¼›è¶…é™è‡ªåŠ¨ pm2 restart
*/
