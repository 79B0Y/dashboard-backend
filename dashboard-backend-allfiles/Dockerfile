# Dockerfile â€“ å¤šé˜¶æ®µæ„å»ºï¼ˆNode 18 + PM2 Runtimeï¼‰
# -----------------------------------------------------------
# æ„å»ºæ­¥éª¤ï¼š
#   1. ä½¿ç”¨ node:18-alpine ä½œä¸ºåŸºç¡€é•œåƒï¼Œå¤åˆ¶ä»£ç å¹¶å®‰è£…ä¾èµ–
#   2. æš´éœ² 3001 ç«¯å£ï¼Œä½¿ç”¨ pm2-runtime å¯åŠ¨
# -----------------------------------------------------------

# ---- æ„å»ºé˜¶æ®µ ----
FROM node:18-alpine AS builder
WORKDIR /app

# å®‰è£…ä¾èµ–ï¼ˆåˆ©ç”¨ç¼“å­˜ï¼‰
COPY package.json package-lock.json* ./
RUN npm ci --omit=dev

# å¤åˆ¶é¡¹ç›®æºç 
COPY . .

# ---- è¿è¡Œé˜¶æ®µ ----
FROM node:18-alpine
WORKDIR /app

# æ‹·è´ä¾èµ– & æºç ï¼ˆä¸å« devDependenciesï¼‰
COPY --from=builder /app /app

# å®‰è£… pm2
RUN npm i -g pm2@latest

EXPOSE 3001
ENV NODE_ENV=production

CMD ["pm2-runtime", "pm2.config.js"]

# ğŸ‰ å®¹å™¨å¯åŠ¨åè¯»å– pm2.config.jsï¼Œå®ˆæŠ¤ server.js è¿›ç¨‹
